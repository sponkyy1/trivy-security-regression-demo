<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trivy Vulnerability Trends</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 2rem;
      text-align: center;
    }
    canvas {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 90%;
      margin: auto;
    }
    h2 {
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <h2>Trivy Vulnerability Trend</h2>
  <canvas id="vulnChart" height="400"></canvas>

  <script>
    async function drawChart() {
      const response = await fetch('data.csv');
      const data = await response.text();

      const rows = data.split('\n').slice(1).filter(Boolean);
      const labels = [];
      const critical = [], high = [], medium = [], low = [];

      for (const row of rows) {
        const [timestamp, c, h, m, l] = row.split(',').map(x => x.trim());
        labels.push(timestamp);
        critical.push(+c);
        high.push(+h);
        medium.push(+m);
        low.push(+l);
      }

      const ctx = document.getElementById('vulnChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Critical',
              data: critical,
              borderColor: 'red',
              backgroundColor: 'rgba(255,0,0,0.1)',
              pointBackgroundColor: 'red',
              pointRadius: 5,
              tension: 0.3,
              fill: false
            },
            {
              label: 'High',
              data: high,
              borderColor: 'orange',
              backgroundColor: 'rgba(255,165,0,0.1)',
              pointBackgroundColor: 'orange',
              pointRadius: 5,
              tension: 0.3,
              fill: false
            },
            {
              label: 'Medium',
              data: medium,
              borderColor: 'gold',
              backgroundColor: 'rgba(255,215,0,0.1)',
              pointBackgroundColor: 'gold',
              pointRadius: 5,
              tension: 0.3,
              fill: false
            },
            {
              label: 'Low',
              data: low,
              borderColor: 'green',
              backgroundColor: 'rgba(0,128,0,0.1)',
              pointBackgroundColor: 'green',
              pointRadius: 5,
              tension: 0.3,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          },
          layout: {
            padding: {
              top: 20,
              bottom: 30,
              left: 15,
              right: 15
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Vulnerabilities'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Scan Timestamp'
              },
              ticks: {
                autoSkip: true,
                maxRotation: 45,
                minRotation: 45
              }
            }
          }
        }
      });
    }

    drawChart();
  </script>
</body>
</html>